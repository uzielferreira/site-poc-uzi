---
kind: pipeline
type: kubernetes
name: default-exemple


steps:
- name: build-push
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run  
  privileged: true
  commands:
  - sleep 5 ## give docker enough time to start
  - docker login -u uzieljr -p zairaf00270027
  - docker build  -t uzieljr/poc-site:latest .
  - docker push uzieljr/poc-site:latest
 
# steps:
# - name: Buildando imagem
#   image: docker:dind
#   volumes:
#   - name: dockersock
#     path: /var/run
#   environment:
#     DOCKER_USER: uzieljr
#     DOCKER_PASSWORD: zairaf00270027
#   commands:
#   - sleep 5 ## give docker enough time to start
#   - docker login -u uzieljr -p zairaf00270027
#   - docker build  -t uzieljr/poc-site:1.0.0 .
#   - docker push uzieljr/poc-site:1.0.0

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run
volumes:
- name: dockersock
  temp: {}

################################################   trigger
trigger:
  branch:
  - main
  when:
    event:
      exclude:
      - pull_request  
      



# kind: pipeline
# type: docker
# name: Build Image and Push

# ##########################################################
# ############################################   Start steps
# ##########################################################


# steps:
# ##################################################   build
# - name: build
#   image: ubuntu:latest
#   pull: always
#   commands:
#   - go build
#   - docker build -t dockerfile .
  

# ################################################   publish
# - name: publish
#   image: done-build-image
#   settings:
#     username: uzieljr
#     password: zairaf00270027
#     repo: uzieljr/poc-site
#     tags:
#     - 1.0.0
#     - 1.0

# ################################################   trigger
# trigger:
#   branch:
#   - main
#   when:
#     event:
#       exclude:
#       - pull_request   

# # # - name: notify
# # #   image: plugins/slack
# # #   settings:
# # #     channel: developers
# # #     username: drone
